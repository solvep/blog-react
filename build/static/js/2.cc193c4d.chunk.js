(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{342:function(e,t,a){},359:function(e,t,a){},360:function(e,t,a){},578:function(e,t,a){"use strict";a.r(t);a(49);var n=a(28),i=a.n(n),s=(a(82),a(8)),r=a.n(s),c=(a(113),a(66)),l=a.n(c),o=a(57),m=(a(65),a(13)),d=a.n(m),h=a(19),u=a(20),v=a(22),f=a(21),g=a(23),b=a(7),p=(a(359),a(360),a(72)),E=a.n(p),w=a(1),O=a.n(w),N=(a(114),a(33)),k=a.n(N),_=(a(342),k.a.TextArea),j=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(v.a)(this,Object(f.a)(t).call(this,e))).state={isLoading:!1,content:""},a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"componentWillMount",value:function(){}},{key:"render",value:function(){var e={id:"",name:"",avatar:""};return window.sessionStorage.userInfo&&(e=JSON.parse(window.sessionStorage.userInfo)),O.a.createElement("div",{className:"comment"},O.a.createElement("div",{className:"avatar"},O.a.createElement(l.a,{className:"auth-logo",size:50,icon:"user",src:e.avatar})),O.a.createElement("h3",null,e.name),O.a.createElement(_,{className:"textarea",name:"content",value:this.props.content,onChange:this.props.handleChange,placeholder:"\u6587\u660e\u793e\u4f1a\uff0c\u7406\u6027\u8bc4\u8bba...",rows:4}),O.a.createElement("div",{className:"new-comment write-function-block"},this.props.isSubmitLoading?O.a.createElement("div",{href:"/",className:"btn btn-send"},"\u53d1\u9001\u4e2d..."):O.a.createElement("div",{href:"/",onClick:this.props.handleAddComment,className:"btn btn-send"},"\u53d1\u9001"),O.a.createElement("div",{className:"cancel"},"\u53d6\u6d88")))}}]),t}(w.Component),y=(a(167),a(144)),C=a.n(y),S=a(35),D=a(36),A=a(60),L=a(333),T=a.n(L),M=(a(117),a(74)),x=a.n(M),I=k.a.TextArea,z=function(e){function t(){return Object(h.a)(this,t),Object(v.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return O.a.createElement(x.a,{title:"\u8bc4\u8bba",style:{top:"25%"},visible:this.props.visible,onCancel:this.props.handleCancel,onOk:this.props.handleOk,width:600},O.a.createElement("div",{className:""},O.a.createElement(I,{rows:4,name:"content",placeholder:"\u6587\u660e\u793e\u4f1a\uff0c\u7406\u6027\u8bc4\u8bba",value:this.props.content,onChange:this.props.handleChange})))}}]),t}(w.Component),J=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(v.a)(this,Object(f.a)(t).call(this,e))).state={isLoading:!1,visible:!1,content:"",comment_id:"",to_user:{},articleDetail:{_id:"",content:"",author:"biaochenxuying",category:[],comments:[],create_time:"",desc:"",id:"",img_url:"",numbers:0,keyword:[],like_users:[],meta:{views:0,likes:0,comments:0},origin:0,state:1,tags:[],title:"",update_time:""},cacheTime:0,times:0},a.handleAddOtherComment=a.handleAddOtherComment.bind(Object(b.a)(Object(b.a)(a))),a.handleChange=a.handleChange.bind(Object(b.a)(Object(b.a)(a))),a.showCommentModal=a.showCommentModal.bind(Object(b.a)(Object(b.a)(a))),a.handleCancel=a.handleCancel.bind(Object(b.a)(Object(b.a)(a))),a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"handleCancel",value:function(){this.setState({visible:!1})}},{key:"showCommentModal",value:function(e,t){if(!window.sessionStorage.userInfo)return d.a.error("\u767b\u5f55\u624d\u80fd\u8bc4\u8bba\uff0c\u8bf7\u5148\u767b\u5f55\uff01"),!1;t?this.setState({visible:!0,comment_id:e._id,to_user:t.user}):this.setState({visible:!0,comment_id:e._id,to_user:e.user})}},{key:"handleChange",value:function(e){this.setState(Object(o.a)({},e.target.name,e.target.value))}},{key:"componentWillMount",value:function(){}},{key:"handleAddOtherComment",value:function(){var e=this;if(this.state.comment_id)if(this.state.times>10)d.a.warning("\u60a8\u4eca\u5929\u8bc4\u8bba\u7684\u6b21\u6570\u5df2\u7ecf\u7528\u5b8c\uff0c\u660e\u5929\u518d\u6765\u8bc4\u8bba\u5427\uff01",1);else{var t=(new Date).getTime();if(t-this.state.cacheTime<6e4)d.a.warning("\u60a8\u8bc4\u8bba\u592a\u8fc7\u9891\u7e41\uff0c1 \u5206\u949f\u540e\u518d\u6765\u8bc4\u8bba\u5427\uff01",1);else if(this.state.content){var a="";if(window.sessionStorage.userInfo)a=JSON.parse(window.sessionStorage.userInfo)._id,this.setState({isLoading:!0}),S.a.post(D.a.addThirdComment,{article_id:this.props.article_id,user_id:a,comment_id:this.state.comment_id,content:this.state.content,to_user:JSON.stringify(this.state.to_user)},{withCredentials:!0}).then(function(a){if(200===a.status&&0===a.data.code){var n=e.state.times+1;e.setState({cacheTime:t,times:n,content:"",visible:!1,isLoading:!1}),e.props.refreshArticle()}else d.a.error(a.data.message)}).catch(function(t){e.setState({visible:!1,isLoading:!1}),console.error(t)});else d.a.warning("\u767b\u5f55\u624d\u80fd\u8bc4\u8bba\uff0c\u8bf7\u5148\u767b\u5f55\uff01")}else d.a.warning("\u8bc4\u8bba\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a!")}else d.a.warning("\u8be5\u7236\u8bc4\u8bba\u4e0d\u5b58\u5728\uff01")}},{key:"render",value:function(){var e=this,t=this.props.list.map(function(t){return O.a.createElement(T.a,{key:t.id,transitionName:"example",transitionAppear:!0,transitionAppearTimeout:1e3,transitionEnterTimeout:1e3,transitionLeaveTimeout:1e3},O.a.createElement("div",{className:"item"},O.a.createElement("div",{className:"item-header"},O.a.createElement("div",{className:"author"},O.a.createElement("div",{className:"avator"},O.a.createElement(l.a,{size:"large",icon:"user",src:t.user.avatar}))),O.a.createElement("div",{className:"info"},O.a.createElement("div",{className:"name"},t.user.name,0===t.user.type?"(\u4f5c\u8005)":""),O.a.createElement("div",{className:"time"},t.create_time?Object(A.g)(t.create_time,!0):""))),O.a.createElement("div",{className:"comment-detail"},t.content),O.a.createElement("div",{className:"item-comment"},O.a.createElement("div",{onClick:function(){return e.showCommentModal(t)},className:"message"},O.a.createElement(l.a,{size:"small",icon:"message"})," \u56de\u590d")),t.other_comments.map(function(a,n){return O.a.createElement("div",{key:a._id,className:"item-other"},O.a.createElement("div",{className:"item-header"},O.a.createElement("div",{className:"author"},O.a.createElement("div",{className:"avator"},O.a.createElement(l.a,{size:"large",icon:"user",src:a.user.avatar}))),O.a.createElement("div",{className:"info"},O.a.createElement("div",{className:"name"},a.user.name,0===a.user.type?"(\u4f5c\u8005)":""),O.a.createElement("div",{className:"time"},a.create_time?Object(A.g)(a.create_time,!0):""))),O.a.createElement("div",{className:"comment-detail"},"@"+a.to_user.name,0===a.to_user.type?"(\u4f5c\u8005)":"","\uff1a",a.content),O.a.createElement("div",{className:"item-comment"},O.a.createElement("div",{onClick:function(){return e.showCommentModal(t,a)},className:"message"},O.a.createElement(l.a,{size:"small",icon:"message"})," \u56de\u590d")))})))});return O.a.createElement("div",{className:"comment-list"},O.a.createElement("div",{className:"top-title"},O.a.createElement("span",null,this.props.numbers," \u6761\u8bc4\u8bba")),O.a.createElement(C.a,{spinning:this.state.isLoading},t),O.a.createElement(z,{visible:this.state.visible,content:this.state.content,handleChange:this.handleChange,handleOk:this.handleAddOtherComment,handleCancel:this.handleCancel}))}}]),t}(w.Component),B=a(112),H=a(361),W=a.n(H),R=a(364),U=a(365),q=a(552),F={add:function(e,t){var a="#toc".concat(t).concat(++this.index);return this.toc.push({anchor:a,level:t,text:e}),a},toHTML:function(){var e=[],t="",a=function(){t+="</ul>\n"},n=function(e,a){t+='<li><a class="toc-link" href="#'+e+'">'+a+"<a></li>\n"};for(this.toc.forEach(function(i){var s=e.indexOf(i.level);if(-1===s)e.unshift(i.level),t+='<ul class="anchor-ul" id="anchor-fix">',n(i.anchor,i.text);else if(0===s)n(i.anchor,i.text);else{for(;s--;)e.shift(),a();n(i.anchor,i.text)}});e.length;)e.shift(),a();return this.toc=[],this.index=0,t},toc:[],index:0},G=new(function(){function e(){Object(h.a)(this,e),this.rendererMD=new q.Renderer,this.rendererMD.heading=function(e,t,a){var n=F.add(e,t);return"<h".concat(t," id=").concat(n,">").concat(e,"</h").concat(t,">\n")},this.rendererMD.table=function(e,t){return'<table class="table" border="0" cellspacing="0" cellpadding="0">'+e+t+"</table>"},U.configure({useBR:!0}),q.setOptions({renderer:this.rendererMD,headerIds:!1,gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,highlight:function(e){return U.highlightAuto(e).value}})}return Object(u.a)(e,[{key:"marked",value:function(){var e=Object(R.a)(W.a.mark(function e(t){var a,n;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=8;break}return e.next=3,q(t);case 3:return a=e.sent,n=F.toHTML(),e.abrupt("return",{content:a,toc:n});case 8:return e.abrupt("return",null);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}]),e}()),K=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(v.a)(this,Object(f.a)(t).call(this,e))).state={isMobile:Object(A.e)(),isLoading:!1,isSubmitLoading:!1,list:[],content:"",type:1,articleDetail:{_id:"",author:"\u591c\u5c3d\u5929\u660e",category:[],comments:[],create_time:"",desc:"",id:16,img_url:"",numbers:0,keyword:[],like_users:[],meta:{views:0,likes:0,comments:0},origin:0,state:1,tags:[],title:"",update_time:""},cacheTime:0,times:0,likeTimes:0},a.handleSearch=a.handleSearch.bind(Object(b.a)(Object(b.a)(a))),a.likeArticle=a.likeArticle.bind(Object(b.a)(Object(b.a)(a))),a.handleChange=a.handleChange.bind(Object(b.a)(Object(b.a)(a))),a.handleAddComment=a.handleAddComment.bind(Object(b.a)(Object(b.a)(a))),a.refreshArticle=a.refreshArticle.bind(Object(b.a)(Object(b.a)(a))),a}return Object(g.a)(t,e),Object(u.a)(t,[{key:"handleAddComment",value:function(){var e=this;if(this.state.articleDetail._id)if(this.state.times>10)d.a.warning("\u60a8\u4eca\u5929\u8bc4\u8bba\u7684\u6b21\u6570\u5df2\u7ecf\u7528\u5b8c\uff0c\u660e\u5929\u518d\u6765\u8bc4\u8bba\u5427\uff01",1);else{var t=(new Date).getTime();if(t-this.state.cacheTime<6e4)d.a.warning("\u60a8\u8bc4\u8bba\u592a\u8fc7\u9891\u7e41\uff0c1 \u5206\u949f\u540e\u518d\u6765\u8bc4\u8bba\u5427\uff01",1);else if(this.state.content){var a="";if(window.sessionStorage.userInfo)a=JSON.parse(window.sessionStorage.userInfo)._id,this.setState({isSubmitLoading:!0}),S.a.post(D.a.addComment,{article_id:this.state.articleDetail._id,user_id:a,content:this.state.content},{withCredentials:!0}).then(function(a){if(200===a.status&&0===a.data.code){d.a.success(a.data.message,1);var n=e.state.times+1;e.setState({cacheTime:t,times:n,isSubmitLoading:!1,content:""});var i=Object(A.b)("article_id");e.handleSearch(i)}else d.a.error(a.data.message,1)}).catch(function(e){console.log(e)});else d.a.warning("\u767b\u5f55\u624d\u80fd\u8bc4\u8bba\uff0c\u8bf7\u5148\u767b\u5f55\uff01",1)}else d.a.warning("\u8bf7\u8f93\u5165\u5185\u5bb9!",1)}else d.a.error("\u8be5\u6587\u7ae0\u4e0d\u5b58\u5728\uff01",1)}},{key:"refreshArticle",value:function(){var e=Object(A.b)("article_id");this.handleSearch(e)}},{key:"handleChange",value:function(e){this.setState(Object(o.a)({},e.target.name,e.target.value))}},{key:"likeArticle",value:function(){var e=this;if(this.state.articleDetail._id)if(this.state.likeTimes>0)d.a.warning("\u60a8\u5df2\u7ecf\u70b9\u8fc7\u8d5e\u4e86\uff01\u60a0\u7740\u70b9\u5427\uff01",1);else{var t="";if(window.sessionStorage.userInfo)t=JSON.parse(window.sessionStorage.userInfo)._id,this.setState({isLoading:!0}),S.a.post(D.a.likeArticle,{id:this.state.articleDetail._id,user_id:t},{withCredentials:!0}).then(function(t){if(200===t.status&&0===t.data.code){var a=e.state.articleDetail;++a.meta.likes;var n=e.state.likeTimes+1;e.setState({likeTimes:n,isLoading:!1,articleDetail:a}),d.a.success(t.data.message,1)}else d.a.error(t.data.message,1)}).catch(function(e){console.log(e)});else d.a.warning("\u767b\u5f55\u624d\u80fd\u70b9\u8d5e\uff0c\u8bf7\u5148\u767b\u5f55\uff01",1)}else d.a.error("\u8be5\u6587\u7ae0\u4e0d\u5b58\u5728\uff01",1)}},{key:"handleSearch",value:function(e){var t=this;this.setState({isLoading:!0}),S.a.post(D.a.getArticleDetail,{id:e,type:this.state.type},{withCredentials:!0}).then(function(e){if(200===e.status&&0===e.data.code){var a=e.data.data;G.marked(e.data.data.content).then(function(e){a.content=e.content,a.toc=e.toc,t.setState({articleDetail:a,isLoading:!1})});var n=e.data.data.keyword.join(","),i=e.data.data.desc,s=e.data.data.title;document.title=s,document.getElementById("keywords").setAttribute("content",n),document.getElementById("description").setAttribute("content",i)}else d.a.error(e.data.message,1)}).catch(function(e){console.log(e)})}},{key:"componentWillUnmount",value:function(){document.title="\u591c\u5c3d\u5929\u660e \u7684\u535a\u5ba2\u7f51\u7ad9",document.getElementById("keywords").setAttribute("content","\u591c\u5c3d\u5929\u660e \u7684\u535a\u5ba2\u7f51\u7ad9"),document.getElementById("description").setAttribute("content","\u5206\u4eab\u5927\u524d\u7aef\u5f00\u53d1\u7b49\u76f8\u5173\u7684\u6280\u672f\u6587\u7ae0\uff0c\u70ed\u70b9\u8d44\u6e90\uff0c\u5168\u6808\u7a0b\u5e8f\u5458\u7684\u6210\u957f\u4e4b\u8def\u3002")}},{key:"componentWillMount",value:function(){var e=this;if("/about"===this.props.location.pathname)this.setState({type:3},function(){var t=Object(A.b)("article_id");e.handleSearch(t)});else{var t=Object(A.b)("article_id");this.handleSearch(t)}}},{key:"render",value:function(){console.log("isMobile :",this.state.isMobile);var e=this.state.isMobile?"100%":"75%",t=this.state.articleDetail.tags.map(function(e,t){return O.a.createElement("span",{key:e.id,className:"tag"},e.name)});return O.a.createElement("div",{className:"article clearfix"},O.a.createElement("div",{className:"detail fl",style:{width:e}},O.a.createElement("div",{className:"header"},O.a.createElement("div",{className:"title"},this.state.articleDetail.title),O.a.createElement("div",{className:"author"},O.a.createElement("div",{className:"avatar"},O.a.createElement(l.a,{className:"auth-logo",src:E.a,size:50,icon:"user"}))," ",O.a.createElement("div",{className:"info"},O.a.createElement("span",{className:"name"},O.a.createElement("span",null,this.state.articleDetail.author)),O.a.createElement("div",{"props-data-classes":"user-follow-button-header","data-author-follow-button":""}),O.a.createElement("div",{className:"meta"},O.a.createElement("span",{className:"publish-time"},this.state.articleDetail.create_time?Object(A.g)(this.state.articleDetail.create_time,!0):""),O.a.createElement("span",{className:"wordage"},"\u5b57\u6570 ",this.state.articleDetail.numbers),O.a.createElement("span",{className:"views-count"},"\u9605\u8bfb ",this.state.articleDetail.meta.views),O.a.createElement("span",{className:"comments-count"},"\u8bc4\u8bba ",this.state.articleDetail.meta.comments),O.a.createElement("span",{className:"likes-count"},"\u559c\u6b22 ",this.state.articleDetail.meta.likes))),O.a.createElement("div",{className:"tags ",title:"\u6807\u7b7e"},O.a.createElement(r.a,{type:"tags",theme:"outlined"}),t),O.a.createElement("span",{className:"clearfix"}))),this.state.isLoading?O.a.createElement(B.a,null):"",O.a.createElement("div",{className:"content"},O.a.createElement("div",{id:"content",className:"article-detail",dangerouslySetInnerHTML:{__html:this.state.articleDetail.content?this.state.articleDetail.content:null}})),O.a.createElement("div",{className:"heart"},O.a.createElement(i.a,{type:"danger",size:"large",icon:"heart",loading:this.state.isLoading,onClick:this.likeArticle},"\u70b9\u8d5e")),O.a.createElement(j,{content:this.state.content,isSubmitLoading:this.state.isSubmitLoading,handleChange:this.handleChange,handleAddComment:this.handleAddComment}),O.a.createElement(J,{numbers:this.state.articleDetail.meta.comments,list:this.state.articleDetail.comments,article_id:this.state.articleDetail._id,refreshArticle:this.refreshArticle})),this.state.isMobile?"":O.a.createElement("div",{style:{width:"23%"},className:"article-right fr anchor",dangerouslySetInnerHTML:{__html:this.state.articleDetail.toc?this.state.articleDetail.toc:null}}))}}]),t}(w.Component);t.default=K}}]);